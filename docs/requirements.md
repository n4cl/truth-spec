# truth-spec 要件定義 v0

## 1. プロダクト概要

### 1.1 目的

truth-spec は、**「仕様書という“性質ごと”に真のドキュメントを 1 つだけ持つ」開発スタイル（s-sdd: single spec driven development）** を実践するためのツールキットである。提供物は次の 2 つ。

- ドキュメントテンプレート群
- LLM / エージェント用ワークフロープロンプト（コマンド群）

従来の「機能ごとに spec を分割する SDD ツール」とは異なり、以下を目的とする。

- 要件定義書・設計書などの「同じ役割のドキュメント」は **常に 1 ファイルに集約する**
- その「真のドキュメント」を **エージェントの力を借りて継続的に更新・育てる**

### 1.2 コンセプト

- **Single Truth per Spec Kind**
  - 要件定義書は `docs/requirements.md` の 1 ファイルが真となる。
  - システム概要設計書は `docs/system-overview.md`、システム詳細設計書は `docs/system-detail.md` が真となる。
  - UI / 画面設計書は `docs/ui-design.md` の 1 ファイルが真となる（必要な場合）。
  - 同じ役割のドキュメントを複数作らず、要件や設計が増えたときは既存ファイルを更新する（分割は「性質」や「具体性」による）。

- **仕様書の種類はプロジェクトが決める**
  - truth-spec が用意するテンプレートは “メニュー” にすぎず、採用・改変・追加は開発者が意思決定する。
  - 性質ごとに 1 ファイルを維持しつつも、性質の切り方（どんなドキュメントを立てるか）はプロジェクトの状況に合わせて設計する。

- **仕様書の構成はプロジェクトで取捨選択できる**
  - 性質ごとに 1 ファイルを維持しつつ、不要な項目は削り、必要な仕様書を分割・追加できる。
  - 各テンプレートは参考用の初期形であり、プロジェクトに合わせて自由に編集する前提とする。

- **Issue との役割分担**
  - 細かいロードマップ・課題・アイデアは GitHub Issues で管理する。
  - 「仕様として固定する」と決めた内容だけ、各 truth-spec（`requirements.md` など）に取り込む。

- **cc-sdd / spec-kit との違い**
  - cc-sdd が「機能ごとに requirements/design を複製」するのに対し、truth-spec は「性質ごとに単一ファイル」を基本とし、設計は具体性に応じて **概要（system-overview）と詳細（system-detail）** にレイヤー分けする。

- **履歴・メタデータの扱いの割り切り**
  - 日々の作業ログやタスク進捗などの詳細な履歴は、truth-spec の対象外とする。
  - リリース単位の履歴（どのバージョンで何が入ったか）は、`docs/release-notes.md` などの Markdown で管理してよい。
  - 開発経緯や細かいアクティビティ履歴は、MCP / 外部サービス（Issue / PR など）からメタデータとして参照することを前提とし、リポジトリ内には持たない。

## 2. 対象・前提

### 2.1 想定利用者

- 個人開発者、または 2〜5 名程度の小規模チーム
- モノレポ or 単一サービスを長期的に育てたい人
- 「spec を乱立させたくない」「要件定義書や設計書は種類ごとに 1 枚でいい」という価値観を持つ人

### 2.2 想定利用環境

- Git を利用した開発（GitHub 前提だと扱いやすい）
- エディタ／エージェントは特定に固定しないが、最初は以下との相性を意識する：
  - ChatGPT / Codex CLI / Claude Code / Cursor などの LLM クライアント
- truth-spec 自体は CLI / MCP / プロンプトテンプレートのいずれか（もしくはその組み合わせ）として提供されることを想定する

## 3. ゴール / ノンゴール

### 3.1 ゴール（truth-spec v0）

1. **“性質ごとの真の仕様書”のフォーマットを定義すること**
   プロジェクト内の以下の役割のドキュメントについて、「真の 1 ファイル」として使う Markdown テンプレートを提供する。
   - 要件定義書：`docs/requirements.md`
   - システム概要設計書：`docs/system-overview.md`
   - システム詳細設計書：`docs/system-detail.md`
   - UI / 画面設計書：`docs/ui-design.md`（任意）
   - （必要に応じて）ドメインモデル設計書：`docs/domain-model.md` など

2. **各 truth-spec を「更新しやすく」するエージェントワークフローを提供すること**
   - LLM に渡すための「開発フロー用プロンプト」を定義する（例: 要件追加・仕様変更・設計更新など）。
   - 「今の truth-spec を読んだ上で、追記・修正案を出させる」流れをサポートする。

3. **Issue との使い分けをガイドとして明文化すること**
   - 「これは truth-spec に書く」「これは Issue に留めておく」という判断基準をドキュメント化する。
   - s-sdd を実践するための運用ガイドラインとして提供する。

4. **テンプレートを“選べる・増やせる”ようにすること**
   - スターターとなるテンプレートカタログを用意しつつ、プロジェクトが要否を判断できるようにする。
   - 新しい性質のドキュメントを追加したいときの作り方・命名・構成例をガイドとして示す。

5. **履歴の扱い方を明確にすること**
   - リリース単位の履歴（どのバージョンでどの機能が利用可能になったか）を管理するための簡易テンプレート例を示す（例：`docs/release-notes.md`）。
   - 作業経緯・タスク進捗などの細かい履歴は、truth-spec の対象外であることを明示する。

### 3.2 ノンゴール（v0）とその理由

- **多 spec 運用**（機能単位で spec を量産する前提）は対応しない。
  - 理由：機能ごとに spec を増やすと、「どの spec が真か」「どの spec を読むべきか」が分散しやすい。
  - truth-spec の目的は「**性質ごとに1つの真**」を作ることで認知負荷とコンテキスト量を下げることであり、多 spec 運用はその思想と逆方向に振れるため。

- **タスク管理・プロジェクト管理（カンバン、バーンダウン等）はやらない。**
  - 理由：タスクや進行管理は GitHub Projects や既存のタスク管理ツールが得意とする領域であり、truth-spec がそこまで抱えるとスコープが肥大化する。
  - また、タスクはプロダクトの「真の仕様」ではなくメタ情報であるため、リポジトリ内の spec と切り離して扱う方が、設計がシンプルになる。

- **日々の作業ログや開発経緯の詳細な履歴の管理は行わない（外部サービス / MCP 側の責務とする）。**
  - 理由：作業ログや経緯は量が膨大になりやすく、LLM に渡す際のノイズにもなりやすい。
  - 「誰がいつどうやって作ったか」よりも、「最終的にどういう仕様になっているか」が truth-spec の関心であり、経緯は MCP など外部ストアから必要に応じて参照できれば十分と考えるため。

- **大規模エンタープライズ向けの重い承認フローや Jira 的な PM ツールの代替は目指さない。**
  - 理由：truth-spec のターゲットは個人〜小規模チームであり、重い承認プロセスや複雑な権限管理を前提とすると、シンプルな運用モデルが崩れる。
  - エンタープライズ向けの要件を取り込むと、仕様テンプレートやワークフローが肥大化し、導入コストが高くなるため。

- **v0 の段階では、GitHub API 連携や自動 Issue 操作は必須としない。**
  - 理由：API 連携を前提にすると、セットアップや権限まわりが一気に重くなる。
  - まずは「テンプレを置いて、LLM にコピペで投げれば使える」レベルの軽量さを優先し、連携機能は v1 以降のオプション的な拡張として検討する。

## 4. 機能要件（v0）

### 4.1 Truth Spec テンプレート提供

**F-001: 各種 truth-spec のテンプレート定義**

- プロジェクトの「真の仕様書」として使う Markdown テンプレートを役割ごとに提供する（スターターカタログ）。
- 最低限提供するテンプレート：
  - `docs/requirements-template.md` → `docs/requirements.md` 用
  - `docs/system-overview-template.md` → `docs/system-overview.md` 用
  - `docs/system-detail-template.md` → `docs/system-detail.md` 用
- 任意のテンプレート（v0 で内容は簡易でもよい）：
  - `docs/ui-design-template.md` → `docs/ui-design.md` 用
  - `docs/domain-model-template.md` → `docs/domain-model.md` 用
  - `docs/release-notes-template.md` → `docs/release-notes.md` 用（リリース単位の履歴を残したい場合）

**F-001-1: requirements.md テンプレ**

- **プロジェクト全体の要件をまとめる前提**で構成する。
- 含めるセクションの例：
  1. 概要（目的・スコープ）
  2. 用語・ドメイン定義
  3. ユースケース / シナリオ（ユーザストーリーなど）
  4. 機能要件（EARS などの形式で列挙）
  5. 非機能要件（性能・信頼性・セキュリティなど）

**F-001-2: system-overview.md テンプレ**

- **全体像と境界を示す概要設計**として構成する。
- 含めるセクションの例：
  1. アーキテクチャ概要（構成図・コンポーネント一覧）
  2. データフロー / シーケンス概要
  3. 主要コンポーネントの役割と責務、境界
  4. 非機能方針（性能・可用性・セキュリティの戦略レベル）
  5. 運用・監視の基本方針
  6. 詳細仕様の所在（`system-detail.md` など）へのリンク

**F-001-3: system-detail.md テンプレ**

- **具体的な仕様・契約・スキーマを記述する詳細設計**として構成する。
- 冒頭に「長文化したら要約・Supporting References へ。1000 行が近づいたら要約または分割検討」という運用注意を明記する。
- 含めるセクションの例：
  1. API 設計（エンドポイント一覧、I/O スキーマ、エラーポリシー、バージョニング）
  2. データモデル / スキーマ詳細（テーブル定義・イベントスキーマ）
  3. 詳細フロー（シーケンス、状態遷移、業務ルール）
  4. 性能・容量見積と予算（クエリ設計、キャッシュ方針）
  5. セキュリティ・権限・監査要件の詳細
  6. 移行・互換性・リリース手順

**F-001-4: その他のテンプレ**

- UI 設計やドメインモデル設計、リリースノートなど、分離したい性質のドキュメント向けに簡易テンプレートを用意する（v0 では最低限の構成でよい）。

**F-001-5: テンプレート追加ガイド**

- 新しい性質のドキュメントを立てたいときの手順をまとめる。
  - いつ分割・新設するかの判断基準（例：情報量が増え s-sdd の「1 ファイル 1 性質」を維持したいとき）。
  - 推奨するファイル命名（例：`docs/<kind>-design.md` など）と配置方針。
  - 最低限書くべき項目のひな形（目的・スコープ・対象読者・アウトプット形式）。
  - 既存テンプレから流用するときのチェックリスト（用語の整合性、参照リンクの更新など）。
  - 実務目安：1 ファイルが大きくなり可読性や LLM への投入サイズが限界に近づいたら、性質を軸に分割を検討する（例：3,000 行超や 200KB 超が見え始めたら再編成を考える）。分割時は親ドキュメントから必ずリンクを張り、「どこが真か」を迷わせない。
  - 将来の分割メモ（v0では実行しない）：`system-detail.md` が肥大化したらインデックス化し、`system-detail-api.md` など必要最小限の分割を検討する。プレフィックス乱立は避け、3〜4枚程度を上限目安とし、相互リンクで迷子を防ぐ。分割時は `docs/system-detail/` ディレクトリを作り、`index.md` を親としたツリー管理も許容する。

### 4.2 s-sdd 用ワークフロー（エージェントプロンプト）定義

**F-002: 仕様追加・変更用プロンプトのひな形**

- LLM に「truth-spec（`requirements.md` / `system-overview.md` / `system-detail.md` など）を読んで変更案を反映する文章を提案して」と依頼するための **プロンプトテンプレート**を提供する。
- 用途別に最低 3 種類を想定：
  - 新しい機能要件を追加するとき（requirements 用）
  - 既存の仕様を変更するとき（requirements / system-overview / system-detail 共通）
  - 実装変更に伴う設計セクションの追従をしたいとき（system-detail / api など）

**F-003: レビュー用プロンプト**

- 「実装や Issue の内容を元に、truth-spec と食い違っていないかチェックする」ためのプロンプトひな形を 1 つ提供する。
- v0 では、コードや Issue は “テキストとして貼る” 前提とし、自動取得は行わない（テキスト入力ベースのレビュー支援）。

### 4.3 運用ガイド

**F-004: s-sdd ガイドラインの提供**

- `docs/s-sdd-guide.md` として以下をまとめたガイドを提供する：
  - truth-spec（`requirements.md` / `system-overview.md` / `system-detail.md` など）に書くべき内容
  - Issue に留めるべき内容（アイデア・バグ・タスク分解など）
  - 新しい機能を追加するときの truth-spec 更新手順例
  - LLM / エージェントにどう指示して編集を手伝わせるかのサンプル
  - リリースノートを使う場合の簡単な書き方例（いつ・どのバージョンで何が追加されたか）

## 5. 非機能要件（v0）

### 5.1 シンプルさ

- truth-spec 導入ステップは、基本的に以下の **最小 3 ステップ** に収まること：
  1. `truth-spec` リポジトリからテンプレをコピー（もしくは `npx` / `uvx` などで導入）
  2. プロジェクト内に `docs/requirements.md` / `docs/system-overview.md` / `docs/system-detail.md` を作る（テンプレからコピー）
  3. ガイドに沿って LLM に話しかける（用意したプロンプトを使う）

### 5.2 ツール非依存性

- Codex / ChatGPT / Claude / Cursor など、どの LLM クライアントでも使えるように、プロンプトテンプレートは「ツール固有のコマンド名」に依存しすぎない形で書く。
- 特定の MCP や CLI への依存は「サンプル実装」として別途切り出す方針とする。

### 5.3 メタデータ・履歴の扱い

- 開発経緯・作業ログ・タスク進捗などのメタデータは、truth-spec の外側で管理することを前提とする。
  - 例：GitHub Issue / PR、外部タスク管理サービス
- LLM に履歴を見せたい場合も、必要に応じて外部ストアから取得したメタデータをプロンプトに含める形とし、truth-spec 自体に詳細履歴を書き込まない。
- ただし、リリース単位の履歴（どのバージョンでどの機能が利用可能になったか）はプロダクト理解に有益なため、`docs/release-notes.md` などとして管理してもよい。

## 6. 将来拡張（v1 以降のアイデア）

※ v0 では要件のみ定義し、実装は対象外とする。

- Git の diff から：「この変更はどの truth-spec（requirements / system-overview / system-detail 等）のどのセクションに影響しそうか？」をエージェントが指摘する機能。
- GitHub Issue との軽い連携：特定ラベル付きの Issue をまとめて読み、「このうち truth-spec に取り込むべきものはどれか」を提案する機能。
- ADR 生成：大きな仕様変更時に `docs/adr/YYYY-xx-title.md` を簡易生成し、「なぜこの変更にしたか」を短く残す機能。
- MCP 経由で開発メタデータ（作業履歴・サイクル情報など）を取得し、truth-spec の更新提案時に「参考情報」として利用する機能。

## 7. 導入パターン

truth-spec は、以下 2 パターンの導入をサポートする。

- P-01: 新規プロジェクトに導入するパターン
- P-02: 既存（途中）プロジェクトに導入するパターン

### 7.1 P-01: 新規プロジェクト導入

**目的**
プロジェクト初期から s-sdd（single spec driven development）を適用し、最初から「性質ごとの真の仕様書」が存在する状態で開発をスタートできるようにする。

**要件**

- P01-01: プロジェクト作成直後に truth-spec を導入できること。テンプレコピーや `init` 的な手順が README / ガイドに明記されていること。
- P01-02: 真の仕様書（`docs/requirements.md` / `docs/system-overview.md` / `docs/system-detail.md` 等）を空 or 最小構成の状態から開始できること。ビジョン・対象ユーザー・初期スコープだけを書いてスタートし、段階的にユースケース・要件・設計を埋めていけること。
- P01-03: 「新規プロジェクトではこう使う」と分かる導入手順をガイドとして提供すること。`docs/s-sdd-guide.md` 内に「新規プロジェクト用セットアップ」セクションを用意する。
- P01-04: 新規プロジェクトにおいて、truth-spec が「最初に作る技術ドキュメント」として位置づけられるよう、デフォルトで `docs/requirements-template.md` / `docs/system-overview-template.md` / `docs/system-detail-template.md` をわかりやすく提示すること。

### 7.2 P-02: 途中（既存）プロジェクト導入

**目的**
すでに一定の実装や Issue が溜まっているプロジェクトに対しても、途中から truth-spec を導入し、「これ以降はここが真」というポイントを作れるようにする。

**要件**

- P02-01: 既存リポジトリに対しても、破壊的変更なく truth-spec を追加できること。`docs/requirements.md` / `docs/system-overview.md` / `docs/system-detail.md` を新規作成するだけで基本が成立すること。
- P02-02: 既存の情報源（Issue / README / Wiki / Notion 等）を元に、truth-spec の初期版を作るための「移行ガイド」を提供すること。既存情報をどう読み込み、どのセクションに要約を書くかの手順例を示すこと。
- P02-03: 「ここから先の仕様変更は truth-spec を更新する」という運用への切り替え方を示すこと。ガイド内に「既存プロジェクトでの切り替えフロー」セクションを用意する。
- P02-04: 既存プロジェクトでも、最初は「ざっくり版の truth-spec」から始められること。すべての既存仕様を書き起こすことを求めず、まずはビジョン・主要ユースケース・現行のコア機能だけを truth-spec にまとめ、以降の変更・追加のたびに truth-spec を育てていく運用を推奨する。
- P02-05: エージェント向けのプロンプト例として、「既存の README / 仕様書 / Issue を貼ると、それをもとに truth-spec のドラフトを作る」ためのプロンプトを 1 つ以上用意する。
